!function(t){var e={};function i(o){if(e[o])return e[o].exports;var s=e[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(o,s,function(e){return t[e]}.bind(null,s));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);let o=(t,e=document)=>e.querySelector(t),s=(t,e=document)=>e.querySelectorAll(t),l=(t,e={})=>{let i=document.createElement(t);for(let t in e)i.setAttribute(t,e[t]);return i},n=(t,e,i,o)=>{t.addEventListener(e,i,!!o)};function r(t,e,i,o,s){n(t,i,i=>{const s=i.target,l=t.querySelectorAll(e);let n=l.length;for(;n--;)if(l[n]===s){o.call(s,i);break}},!!s)}let d=t=>t.dataset.id?t.dataset.id:t!==document?d(t.parentNode):void 0,a=(t,e,i,o=document)=>{let l=s(e,o);for(let e=0;e<l.length;e++)l[e]===t?l[e]===t&&l[e].classList.add(i):l[e].classList.remove(i)};let c=new class{constructor(t){this.template=t,this.newItem=o(".new-item"),this.itemList=o(".item-list"),this.count=o(".count"),this.clearAllBtn=o(".clear-complete"),this.toggleAll=o(".toggle-all"),this.footer=o(".footer")}setItems(t){this.itemList.innerHTML=this.template.setItems(t)}setCount(t){this.count.innerText=t>0?this.template.activeCount(t):""}editItemBegin(t,e){t.appendChild(this.template.setEdit(e));let i=o("textarea",t);setTimeout(i.focus(),0)}editItemSave(t){t.parentElement.removeChild(t)}cleanNewItem(){this.newItem.value=""}bindAddItem(t){n(this.newItem,"change",e=>{t(e.target),this.cleanNewItem()})}bindDeleteItem(t){r(this.itemList,".destroy","click",t)}bindCompletedToggly(t){r(this.itemList,".checkbox","click",t)}bindEditItemBegin(t){r(this.itemList,".content","dblclick",e=>{t(e)})}bindFilter(t){r(this.footer,".btn","click",e=>{t(e),a(e.target,".btn","chosen",this.footer)})}bindClearCompleted(t){n(this.clearAllBtn,"click",t),n(this.clearAllBtn,"click",()=>{let t=s(".btn",this.footer)[0];a(t,".btn","chosen",this.footer)})}bindToggleAll(t){n(this.toggleAll,"click",t)}bindEditItemSave(t){r(this.itemList,".edit>textarea","blur",t,!0),r(this.itemList,".edit>textarea","keypress",({target:t,keyCode:e})=>{13===e&&t.blur()},!0),r(this.itemList,".edit>textarea","keydown",({target:t,keyCode:e})=>{27===e&&(t.dataset.esc="true",t.blur())},!0)}}(new class{setItems(t){let e="";for(let i in t)e+=`<div data-id="${i}" class="todo-item">\n\t\t\t\t      <div class="${t[i].complete?"complete":"active"}">\n\t\t\t\t          <input type="checkbox" class="checkbox">\n\t\t\t\t          <label class="content">${t[i].content}</label>\n\t\t\t\t          <button class="destroy"></button>\n\t\t\t\t\t  </div>\n\t\t\t\t  </div>`;return e}setItem(t,e){let i=l("div",{class:"todo-item","data-id":e}),o=`<div class="${t.complete?"complete":"active"}">\n\t\t\t\t\t\t<input type="checkbox" class="checkbox">\n\t\t\t\t\t\t<label class="content">${t.content}</label>\n\t\t\t\t\t\t<button class="destroy"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`;return i.innerHTML=o,i}setEdit(t){let e=l("div",{class:"popap"}),i=`<div class="edit">\n\t\t\t\t     <textarea cols="100" rows="10">${t}</textarea>\n\t\t\t\t </div>`;return e.innerHTML=i,e}activeCount(t){let e=t%10;return 1==e?t+" задание":e>1&&e<=4?t+" задания":e>4?t+" заданий":t>10&&t<15?t+" заданий":void 0}}),m=new class{constructor(t,e){this.model=t,this.view=e,e.bindAddItem(this.addItem.bind(this)),e.bindDeleteItem(this.deleteItem.bind(this)),e.bindCompletedToggly(this.completedToggle.bind(this)),e.bindEditItemBegin(this.editItemBegin.bind(this)),e.bindEditItemSave(this.editItemSave.bind(this)),e.bindFilter(this.viewFilter.bind(this)),e.bindClearCompleted(this.deleteCompleted.bind(this)),e.bindToggleAll(this.toggleAll.bind(this))}setItems(){this.view.setItems(this.model.getTodo()),this.setCount()}viewFilter(t){let e=t.target.dataset.filter;e&&("all"!==e?this.view.setItems(this.model.filter(+e)):this.setItems())}deleteCompleted(){this.model.deletCompleted(),this.setItems()}addItem(t){let e=Date.now(),i={content:t.value.trim(),complete:!1};this.model.setTodo(i,e),this.setItems()}deleteItem(t){let e=d(t.target);this.model.deletTodo(e),this.setItems()}completedToggle(t){let e=d(t.target);this.model.setComplete(e),this.setItems()}editItemBegin(t){let e=t.target.parentElement.parentElement,i=t.target.innerText;this.view.editItemBegin(e,i)}editItemSave(t){if(t.target.dataset.esc)return void this.setItems();let e=t.target.parentElement.parentElement,i=d(t.target),o=t.target.value.trim();this.model.editTodo(i,o),this.view.editItemSave(e),this.setItems()}toggleAll(){this.model.toggleAll(),this.setItems()}setCount(){this.view.setCount(this.model.activeCount())}}(new class{constructor(t){this.storage=t,this.todo=this.getTodo()}getTodo(){return this.todo||this.storage.getLocalStorage()}setTodo(t,e){let i=this.getTodo();i[e]=t,this.storage.setLocalStorage(this.todo=i)}editTodo(t,e){let i=this.getTodo();e!=i[t].content&&""!=e&&(i[t].content=e,this.storage.setLocalStorage(this.todo=i))}setComplete(t){let e=this.getTodo();e[t].complete=!e[t].complete,this.storage.setLocalStorage(this.todo=e)}deletTodo(t){let e=this.getTodo();delete e[t],this.storage.setLocalStorage(this.todo=e)}deletCompleted(){let t=this.getTodo();for(let e in t)t[e].complete&&this.deletTodo(e)}toggleAll(){let t=this.getTodo(),e=!1,i=[];for(let o in t)t[o].complete||(e=!0,i.push(o));if(e)i.forEach(t=>{this.setComplete(t)});else for(let e in t)this.setComplete.call(this,e)}activeCount(){if(!this.todo)return 0;let t=0;for(let e in this.todo)this.todo[e].complete||t++;return t}filter(t){let e=this.getTodo(),i={},o={};for(let t in e)e[t].complete?i[t]=e[t]:o[t]=e[t];return t?i:o}}(new class{constructor(t){const e=window.localStorage;this.getLocalStorage=(()=>JSON.parse(e.getItem(t)||"{}")),this.setLocalStorage=(i=>{e.setItem(t,JSON.stringify(i))})}}("mara")),c);window.onload=(()=>{m.setItems()})}]);